# TitanFlow Environment Configuration
# ============================================================
# Copy this file to .env and fill in your values.
# NEVER commit .env to version control.
# For production, store secrets in AWS Secrets Manager or Vault.
# ============================================================


# ============================================================
# ALPACA API CREDENTIALS
# ============================================================
# Use SEPARATE key pairs for read-only monitoring vs. trade execution (RBAC).
#
# Trade execution keys (TitanAlpacaConnector, AlpacaExecutor):
ALPACA_API_KEY=your_alpaca_api_key
ALPACA_SECRET_KEY=your_alpaca_secret_key
ALPACA_BASE_URL=https://paper-api.alpaca.markets

# Read-only keys for monitoring / dashboard (optional — use separate Alpaca sub-account):
# ALPACA_READONLY_API_KEY=your_readonly_key
# ALPACA_READONLY_SECRET_KEY=your_readonly_secret

# Polygon.io (optional secondary data feed):
POLYGON_API_KEY=your_polygon_api_key


# ============================================================
# DATABASE CONFIGURATION
# ============================================================

# PostgreSQL (transactional data — orders, accounts, strategy metadata)
POSTGRES_USER=titan_user
POSTGRES_PASSWORD=titan_password
POSTGRES_DB=titan_db
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# QuestDB (time-series tick storage)
QUESTDB_HOST=questdb
QUESTDB_PG_PORT=8812
QUESTDB_HTTP_PORT=9000
QUESTDB_ILP_PORT=9009

# Redis (message broker — Pub/Sub channels)
REDIS_HOST=redis
REDIS_PORT=6379


# ============================================================
# EXECUTION MODE
# ============================================================
# paper — simulated trades with real market feed (safe default)
# live  — real Alpaca order submission (requires approved risk flow)
EXECUTION_MODE=paper

# Paper trading configuration
PAPER_STARTING_CASH=100000
PAPER_RISK_PER_TRADE=0.10
PAPER_MIN_CONFIDENCE=0.25
PAPER_PORTFOLIO_PUBLISH_SECONDS=2
PAPER_MAX_MODELS=10

# Live execution — TitanAlpacaConnector settings
ALPACA_MIN_CONFIDENCE=0.60        # Minimum model confidence to submit an order (0–1)
ALPACA_RISK_PER_TRADE=0.02        # Fraction of equity risked per trade (2%)
ACCOUNT_POLL_SECONDS=30           # How often to poll Alpaca account for circuit-breaker check


# ============================================================
# CIRCUIT BREAKER (Kill Switch)
# ============================================================
# Automatically halts ALL trading and liquidates positions when triggered.
CIRCUIT_BREAKER_DRAWDOWN_PCT=0.03          # 3% daily loss hard stop
CIRCUIT_BREAKER_CONSECUTIVE_LOSSES=5      # Max consecutive losing trades before halt


# ============================================================
# MODEL ROLLBACK (Manual Approval Mode)
# ============================================================
# When rolling model metrics fall below these thresholds, the system
# automatically switches to manual-approval mode — signals are logged
# but NOT auto-executed until an operator resets the flag.
ROLLBACK_MIN_SHARPE=0.50          # Minimum rolling Sharpe ratio (annualised)
ROLLBACK_MIN_ACCURACY=0.50        # Minimum rolling directional accuracy (50%)
RISK_PERF_CHECK_INTERVAL=10       # Evaluate model metrics every N signals


# ============================================================
# RISK ENGINE
# ============================================================
RISK_MAX_DAILY_LOSS=0.03          # Mirror of CIRCUIT_BREAKER_DRAWDOWN_PCT for RiskEngine
RISK_MAX_POSITION_SIZE=0.10       # Max single-position size as fraction of equity
RISK_PER_TRADE=0.01               # Fixed fractional risk per trade (1%)


# ============================================================
# SIGNAL ENGINE & MODELS
# ============================================================
MODEL_PATH=./services/signal/checkpoints/hybrid_v1.pt
MODEL_VERSION=v1.0                # Semantic version tag written to every audit record
DATA_PROVIDER=synthetic           # synthetic | alpaca


# ============================================================
# AUDIT LOGGING (MLOps compliance)
# ============================================================
# Every signal, order, fill, kill-switch, and rollback event is appended
# to this JSONL file and also published to the Redis "audit_events" channel.
AUDIT_LOG_PATH=./logs/trade_audit.jsonl
